<div class="wrapper">

    <input type="hidden" name="attr_brildie"/>
    <input type="hidden" name="attr_gendie"/>
    <input type="hidden" name="attr_litonedie"/>
    <input type="hidden" name="attr_littwodie"/>
    <input type="hidden" name="attr_xptier"/>
    <input type="hidden" name="attr_condvig"/>
    <input type="hidden" name="attr_condcov"/>
    <input type="hidden" name="attr_personalfat"/>

    <input type="hidden" class="tabstoggle" name="attr_sheetTab" value="page1"/>
    <div>
        <button type="action" name="act_page1" class="tabs">Core</button>
        <button type="action" name="act_page2" class="tabs">Talents</button>
		<button type="action" name="act_page3" class="tabs">Equipment</button>
		<button type="action" name="act_page4" class="tabs">Character</button>
        <button type="action" name="act_recalc" class="tabs">Recalc</button>
    </div>

    <div class="page1">
    
        <div id="lvdiv" class="level">Level Up!</div>
	
        <div class="section">
			<div>
				<h3>Character</h3>
				<div class="twocolumns">
					<div class="labels">
						<label>Name</label>
						<label>Species</label>
						<label>Size</label>
						<label>Motive</label>
						<label>Strength</label>
						<label>Weakness</label>
						<label>Quirk</label>
                        <label>Starting Class</label>
					</div>
					<div class="valuecolumn">
						<input type="text" name="attr_character_name"/>
						<input type="text" name="attr_species"/>
						<input type="text" name="attr_size"/>
						<input type="text" name="attr_motive"/>
						<select name="attr_strength">
                            <option value="Conviction">Strong Willed</option>
                            <option value="Insight">Compassionate</option>
                            <option value="Cunning">Charming</option>
                            <option value="Fatigue Die">Relentless</option>
                            <option value="Vigor">Exuberant</option>
                            <option value="Deftness">Elegant</option>
                        </select>
						<select type="text" name="attr_weakness">
                            <option value="Conviction">Cowardly</option>
                            <option value="Insight">Narcissist</option>
                            <option value="Cunning">Dense</option>
                            <option value="Fatigue Die">Manipulative</option>
                            <option value="Vigor">Slovenly</option>
                            <option value="Deftness">Clumsy</option>
                        </select>                        
						<input type="text" name="attr_quirk"/>
                        <select name="attr_starting">
                            <option value="Soldier">Soldier</option>
                            <option value="Scoundrel">Scoundrel</option>
                            <option value="Leader">Leader</option>
                            <option value="Diplomat">Diplomat</option>
                            <option value="Scholar">Scholar</option>
                            <option value="Medic">Medic</option>
                        </select>
					</div>
				</div>
			</div>
			
			<div class="marginleft">
				<h3>Stats</h3>
				<div class="twocolumns">
					<div class="labels">
						<label>Fatigue Die</label>
                        <label>Bonus Fatigue</label>
						<label>Armor</label>
						<label>Prosperity</label>
						<label>Experience Points</label>						
						<label>Character Level</label>
                        <label>NPC?</label>
					</div>
					<div class="valuecolumn">
						<div>
							<input type="number" min="0" max="99" name="attr_fatdie" value="0"/> / <input type="number" min="0" max="99" name="attr_fatdiemax" value="@{vigor} + @{backfat} + @{bonusfat} + @{personalfat}" disabled="true"/>
						</div>
                        <input type="number" min="0" max="99" name="attr_backfat" value="0"/>
						<div>
							<input type="number" min="0" max="99" name="attr_armorcur" value="0"/> / <input type="number" name="attr_armormax" value="@{armorhp}" disabled="true"/>
						</div>
						<div>
							<input type="number" min="-99" max="99" name="attr_prosperity" value="0"/>
						</div>
						<div>
							<input type="number" min="0" max="9999" name="attr_xp" value="0"/> / <input type="number" name="attr_needed_xp" value="@{chrlv} * @{xptier}" style="width: 4.1em;" disabled="true"/>
						</div>						
                        <div>
                            <input type="number" min="0" max="99" name="attr_chrlv" value="0"/>
                        </div>
                        <div>
                            <input type="checkbox" name="attr_npc" value="1"/>
                        </div>
					</div>
				</div>			
			</div>			
			
            <div class="marginleft">
                <h3>Classes</h3>
                <div class="twocolumns">
                    <div class="labels">
                        <label>Soldier</label>
                        <label>Scoundrel</label>
                        <label>Leader</label>
						<label>Diplomat</label>
						<label>Scholar</label>
						<label>Medic</label>
						<label>Specialist</label>
						<label>Prestige</label>
                    </div>
                    <div class="valuecolumn">
                        <input type="number" min="0" max="99" name="attr_soldierlv" value="0"/>
						<input type="number" min="0" max="99" name="attr_scoundrellv" value="0"/>
						<input type="number" min="0" max="99" name="attr_leaderlv" value="0"/>
						<input type="number" min="0" max="99" name="attr_diplomatlv" value="0"/>
						<input type="number" min="0" max="99" name="attr_scholarlv" value="0"/>
						<input type="number" min="0" max="99" name="attr_mediclv" value="0"/>
						<input type="number" min="0" max="99" name="attr_specialistlv" value="0"/>
						<input type="number" min="0" max="99" name="attr_prestigelv" value="0"/>
                    </div>
                </div>
            </div>
		</div>
			
		<div class="section">
			<div class="ability" style="padding-left: 25px;">
				<div class="labels">
					<label><h3>Vigor</h3></label>
				</div>
				<div class="valuecolumn">
					<div>
						<input type="number" min="0" max="99" name="attr_vigor" value="1"/>
					</div>
				</div>		
			</div>
			<div class="ability">
				<div class="labels">
					<label><h3>Deftness</h3></label>
				</div>
				<div class="valuecolumn">
					<div>
						<input type="number" min="0" max="99" name="attr_deft" value="1"/>
					</div>
				</div>		
			</div>
			<div class="ability">
				<div class="labels">
					<label><h3>Cunning</h3></label>
				</div>
				<div class="valuecolumn">
					<div>
						<input type="number" min="0" max="99" name="attr_cun" value="1"/>
					</div>
				</div>		
			</div>			
			<div class="ability">
				<div class="labels">
					<label><h3>Insight</h3></label>
				</div>
				<div class="valuecolumn">
					<div>
						<input type="number" min="0" max="99" name="attr_ins" value="1"/>
					</div>
				</div>		
			</div>
			<div class="ability">
				<div class="labels">
					<label><h3>Conviction</h3></label>
				</div>
				<div class="valuecolumn">
					<div>
						<input type="number" min="0" max="99" name="attr_cov" value="1"/>
					</div>
				</div>		
			</div>
			<div class="ability">
				<div class="labels">
					<label><h3>Total</h3></label>
				</div>
				<div class="valuecolumn">
					<div>
						<input type="number" name="attr_abcur" readonly/> / <input type="number" name="attr_abtotal" readonly/>
					</div>
				</div>		
			</div>            
		</div>

		<div class="section">
			<div class="skillsection">
				<h3>Body</h3>                
				<div class="twocolumns">
					<div class="labelcolumn">
						<button type="roll" name="Melee" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Melee}} {{result=[[{(@{melee}+@{melee_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Melee</button>
						<button type="roll" name="Ranged" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Ranged}} {{result=[[{(@{ranged}+@{ranged_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Ranged</button>
						<button type="roll" name="Acrobatics" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Acrobatics}} {{result=[[{(@{acrobatics}+@{acrobatics_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Acrobatics</button>
                        <button type="roll" name="Athletics" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Athletics}} {{result=[[{(@{athletics}+@{athletics_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Athletics</button>
						<button type="roll" name="Stealth" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Stealth}} {{result=[[{(@{stealth}+@{stealth_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Stealth</button>
						<button type="roll" name="Pilot" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Pilot}} {{result=[[{(@{pilot}+@{pilot_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Pilot</button>
						<button type="roll" name="Endurance" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Endurance}} {{result=[[{(@{endurance}+@{endurance_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Endurance</button>                        
                        <label style="text-align: center; margin-top: 3%;">Specialities</label>
                        <label style="text-align: center; margin-top: 3%;">Ranks</label>
					</div>
					<div class="valuecolumn">
						<input type="number" min="0" max="4" name="attr_melee" value="0"/>
						<input type="number" min="0" max="4" name="attr_ranged" value="0"/>
						<input type="number" min="0" max="4" name="attr_acrobatics" value="0"/>
						<input type="number" min="0" max="4" name="attr_athletics" value="0"/>
						<input type="number" min="0" max="4" name="attr_stealth" value="0"/>
						<input type="number" min="0" max="4" name="attr_pilot" value="0"/>
						<input type="number" min="0" max="4" name="attr_endurance" value="0"/>
                        <input type="number" min="0" max="99" name="attr_bodyspec" value="0"/>
                        <input type="number" name="attr_assignbody" readonly/>
					</div>			
					<div class="modcolumn">
						<input type="number" min="-99" max="99" name="attr_melee_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_ranged_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_acrobatics_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_athletics_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_stealth_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_pilot_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_endurance_mod" value="0"/>	
                        <input type="number" class="hidetoalign"/>
                        <input type="number" name="attr_maxbody" readonly/>
					</div>					
				</div>
			</div>
			
			<div class="skillsection">
				<h3>Mental</h3>
				<div class="twocolumns">						
					<div class="labelcolumn">
						<button type="roll" name="Deception" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Deception}} {{result=[[{(@{deception}+@{deception_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Deception</button>
						<button type="roll" name="Persuasion" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Persuasion}} {{result=[[{(@{persuasion}+@{persuasion_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Persuasion</button>
						<button type="roll" name="Intimidation" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Intimidation}} {{result=[[{(@{intimidation}+@{intimidation_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Intimidation</button>
						<button type="roll" name="Empathy" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Empathy}} {{result=[[{(@{empathy}+@{empathy_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Empathy</button>
						<button type="roll" name="Deduction" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Deduction}} {{result=[[{(@{deduction}+@{deduction_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Deduction</button>
						<button type="roll" name="Perception" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Perception}} {{result=[[{(@{perception}+@{perception_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Perception</button>
						<button type="roll" name="Resolve" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Resolve}} {{result=[[{(@{resolve}+@{resolve_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Resolve</button>
                        <label style="text-align: center; margin-top: 3%;">Specialities</label>
                        <label style="text-align: center; margin-top: 3%;">Ranks</label>
					</div>
					<div class="valuecolumn">
						<input type="number" min="0" max="4" name="attr_deception" value="0"/>
						<input type="number" min="0" max="4" name="attr_persuasion" value="0"/>
						<input type="number" min="0" max="4" name="attr_intimidation" value="0"/>
						<input type="number" min="0" max="4" name="attr_empathy" value="0"/>
						<input type="number" min="0" max="4" name="attr_deduction" value="0"/>
						<input type="number" min="0" max="4" name="attr_perception" value="0"/>
						<input type="number" min="0" max="4" name="attr_resolve" value="0"/>
                        <input type="number" min="0" max="99" name="attr_mentspec" value="0"/>                
                        <input type="number" name="attr_assignmental" readonly/>
					</div>	
					<div class="modcolumn">
						<input type="number" min="-99" max="99" name="attr_deception_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_persuasion_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_intimidation_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_empathy_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_deduction_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_perception_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_resolve_mod" value="0"/>	
                        <input type="number" class="hidetoalign"/>
                        <input type="number" name="attr_maxmental" readonly/>
					</div>						
				</div>
			</div>

			<div class="skillsection">
				<h3>Knowledge</h3>
				<div class="twocolumns">						
					<div class="labelcolumn">
						<button type="roll" name="Art" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Art}} {{result=[[{(@{art}+@{art_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Art</button>
						<button type="roll" name="Engineering" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Engineering}} {{result=[[{(@{engineering}+@{engineering_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Engineering</button>
						<button type="roll" name="Logistics" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Logistics}} {{result=[[{(@{logistics}+@{logistics_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Logistics</button>
						<button type="roll" name="Social" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Social}} {{result=[[{(@{social}+@{social_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Social</button>
						<button type="roll" name="Science" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Science}} {{result=[[{(@{science}+@{science_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Science</button>
						<button type="roll" name="Medicine" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Medicine}} {{result=[[{(@{medicine}+@{medicine_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Medicine</button>
						<button type="roll" name="Survival" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Survival}} {{result=[[{(@{survival}+@{survival_mod}+?{Ability|Vigor, @{vigor}|Deftness, @{deft}|Cunning, @{cun}|Insight, @{ins}|Conviction, @{cov}}-@{treated}+?{Modifiers|0})d6}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Survival</button>
                        <label style="text-align: center; margin-top: 3%;">Specialities</label>                        
                        <label style="text-align: center; margin-top: 3%;">Ranks</label>
					</div>
					<div class="valuecolumn">
						<input type="number" min="0" max="4" name="attr_art" value="0"/>
						<input type="number" min="0" max="4" name="attr_engineering" value="0"/>
						<input type="number" min="0" max="4" name="attr_logistics" value="0"/>
						<input type="number" min="0" max="4" name="attr_social" value="0"/>
						<input type="number" min="0" max="4" name="attr_science" value="0"/>
						<input type="number" min="0" max="4" name="attr_medicine" value="0"/>
						<input type="number" min="0" max="4" name="attr_survival" value="0"/>
                        <input type="number" min="0" max="99" name="attr_knowspec" value="0"/>
                        <input type="number" name="attr_assignknowledge" readonly/>
					</div>		
					<div class="modcolumn">
						<input type="number" min="-99" max="99" name="attr_art_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_engineering_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_logistics_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_social_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_science_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_medicine_mod" value="0"/>
						<input type="number" min="-99" max="99" name="attr_survival_mod" value="0"/>
                        <input type="number" class="hidetoalign"/>						
                        <input type="number" name="attr_maxknowledge" readonly/>
					</div>						
				</div>
			</div>
					
			</div>
			
			<div class="buttonsection">
                <button type="roll" name="Init" value="&{template:default} {{name=@{character_name}}} {{Initiative= [[(?{# of actions(6)?|0}*6)+(?{# of half actions(3)?|0}*3)-?{Fast|0}+?{Slow|0}-@{deft}]]}}">Initiative</button>
			    <button type="roll" name="ZeroDie" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Zero Die}} {{result=[[{2d6kl1}>5-?{Weak|0}+?{Strong|0}-@{injuries}]]}}">Zero Die</button>
                <button id="solbut" class="hide" type="roll" name="Maintenance" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Maintenance}} {{result=[[{(@{engineering})d6}>5]]}}">Maintenance</button>
                <button id="solbut" class="hide" type="roll" name="Shoulder" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Shoulder to Shoulder}} {{result=[[{(@{logistics})d6}>5]]}}">Shoulder</button>                
                <button id="scobut" class="hide" type="roll" name="SneakAttack" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Sneak Attack}} {{result=[[{(@{cun})d6}>5]]}}">Sneak Attack</button>
                <button id="scobut" class="hide" type="roll" name="Lightning" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Lightning Strike}} {{result=[[{(?{Weapon|One, @{litonedie}|Two, @{littwodie}})d6}>5]]}}">Lightning</button>
                <button id="ledbut" class="hide" type="roll" name="Affable" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Affable}} {{result=[[{(@{empathy})d6}>5]]}}">Affable</button>
                <button id="ledbut" class="hide" type="roll" name="Stand" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Stand Tall}} {{result=[[{(@{cov})d6}>5]]}}">Stand</button>
                <button id="dipbut" class="hide" type="roll" name="Gravitas" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Gravitas}} {{result=[[{(@{cun})d6}>5]]}}">Gravitas</button>
                <button id="dipbut" class="hide" type="roll" name="Noble" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Noble Bearing}} {{result=[[{(@{social} + ?{Rich|Yes, @{social}|No, 0})d6}>5]]}}">Noble</button>
                <button id="dipbut" class="hide" type="roll" name="Fashion" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Fashionable}} {{result=[[{1+(@{art})d6}>5]]}}">Fashion</button>
                <button id="dipbut" class="hide" type="roll" name="Flourish" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Flourish}} {{result=[[{(@{art})d6}>5]]}}">Flourish</button>
                <button id="schbut" class="hide" type="roll" name="Brilliance" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Brilliance}} {{result=[[{(@{brildie})d6}>5]]}}">Brilliance</button>
                <button id="schbut" class="hide" type="roll" name="Genius" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Stroke of Genius}} {{result=[[{(@{gendie} + ?{Learned|Yes, @{gendie}|No, 0})d6}>5]]}}">Genius</button>
                <button id="schbut" class="hide" type="roll" name="Observe" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Astute Observation}} {{result=[[{(@{ins})d6}>5]]}}">Observe</button>
                <button id="schbut" class="hide" type="roll" name="Tactics" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Superior Tactics}} {{result=[[{(?{Difference?|0})d6}>5]]}}">Tactics</button>                
                <button id="medbut" class="hide" type="roll" name="Manner" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Bedside Manner}} {{result=[[{(@{medicine})d6}>5]]}}">Manner</button>
                <button id="medbut" class="hide" type="roll" name="Hands" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Surgeon's Hands}} {{result=[[{(@{deft})d6}>5]]}}">Hands</button>
                <button id="medbut" class="hide" type="roll" name="Combat" value="&{template:wod} {{name=@{character_name}}} {{roll_name=Combat Medic}} {{result=[[{(@{medicine})d6}>5]]}}">Combat</button>
                <button id="medbut" class="hide" type="roll" name="Doctor" value="&{template:wod} {{name=@{character_name}}} {{roll_name=“I’m a doctor not a-”}} {{result=[[{(@{medicine})d6}>5]]}}">Doctor</button>
			</div>      

            
            
			<div class="section">
                <div> 
                    <div class="twocolumns">
                        <div class="labels">
                            <label title="Weak(1) if you haven&apos;t used in 24 hrs. Months">Addicted</label>
                            <label title="Weak(1) if it helps to see. If temp">Blinded</label>
                            <label title="Can&apos;t attack Charmer. Weak(1) to Defend vs them">Charmed</label>
                            <label title="Slow(2). No Reactions">Dazed</label>
                        </div>
                        <div class="valuecolumn">
                            <div>
                                <input type="number" min="0" max="10" name="attr_addicted" value="0"/> / <input type="number" name="attr_addictedmax" value="10 - @{condcov}" disabled="true"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="5" name="attr_blinded" value="0"/> / <input type="number" name="attr_blindedmax" value="5 - @{condvig}" disabled="true"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="5" name="attr_charmed" value="0"/> / <input type="number" name="attr_charmedmax" value="5 - @{condcov}" disabled="true"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="5" name="attr_dazed" value="0"/> / <input type="number" name="attr_dazedmax" value="5 - @{condvig}" disabled="true"/>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="marginleft">
                    <div class="twocolumns">
                        <div class="labels">
                            <label title="Weak(1) if it helps to hear. If temp">Deafened</label>
                            <label title="Can&apos;t attack">Demoralized</label>
                            <label title="Must attack Enrager. Strong(1) on Vigor. Weak(1) on Insight">Enraged</label>
                            <label title="Slow(2) and Weak(1) per level">Exhausted</label>
                        </div>
                        <div class="valuecolumn">
                            <div>
                                <input type="number" min="0" max="5" name="attr_deafened" value="0"/> / <input type="number" name="attr_deafenedmax" value="5 - @{condvig}" disabled="true"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="10" name="attr_demoralized" value="0"/> / <input type="number" name="attr_demoralizedmax" value="10 - @{condcov}" disabled="true"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="5" name="attr_enraged" value="0"/> / <input type="number" name="attr_enragedmax" value="5 - @{condcov}" disabled="true"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="10" name="attr_exhuasted" value="0"/>
                            </div>
                        </div>
                    </div>			
                </div> 

                <div class="marginleft">
                    <div class="twocolumns">
                        <div class="labels">
                            <label title="Weak(1). Auto-added">Injuries</label>
                            <label title="-1 mod. Auto-added">Treated Injuries</label>
                            <label title="Using Rest and Recover">Weeks to Heal</label>
                        </div>
                        <div class="valuecolumn">
                            <div>
                                <input type="number" min="0" max="10" name="attr_injuries" value="0"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="99" name="attr_treated" value="0"/>
                            </div>
                            <div>
                                <input type="number" min="0" max="5" name="attr_heal" value="0"/> / <input type="number" name="attr_healmax" value="5 - @{condvig}" disabled="true"/>
                            </div>
                        </div>
                    </div>			
                </div>                
            </div>            
			
			<div class="section">
				<div class="bottomsection">
					<h3>Conditions</h3>
					<div class="twocolumns">                                        
						<fieldset class="repeating_conditions">
							<input type="text" name="attr_conditions"/>
						</fieldset>	
					</div>
				</div>
				
				<div class="bottomsection">
					<h3>Specialties & Prestige</h3>
					<div class="twocolumns">
						<fieldset class="repeating_specialities">
							<input type="text" name="attr_specialities"/>
						</fieldset>	
					</div>
				</div>
			</div>			
		
    </div>
    
    <div class="page2">

		<div>
			<h3>Talents</h3>
			<fieldset class="repeating_talents">
				<textarea name="attr_talent" class="textarea"></textarea>
			</fieldset>
		</div>
        
    </div>

    <div class="page3">
        
		<div>
            <div class="twocolumns" style="margin-bottom: 1%">
                <div class="labels">
                    <label>Bulk</label>
                </div>
                <div class="valuecolumn">
                    <div>
                        <input type="number" name="attr_bulksum" value="@{weapononebulk} + @{weapontwobulk} + @{stowbulksum}" disabled="true"/> / <input type="number" name="attr_total_bulk" value="(@{vigor} * 3 + 3)" disabled="true"/>
                    </div>
                </div>
            </div>
            
            <div>
                <h3>Armor</h3>
                
                <div class="twocolumns" style="margin-bottom: 1%">
                    <div class="labels">
                        <label>Type</label>
                        <label>HP</label>
                        <label>Notes</label>
                    </div>
                    <div class="valuecolumn">
                        <input type="text" name="attr_armor" title="Armor"/>
                        <input type="number" min="0" max="99" name="attr_armorhp" value="0" title="HP"/>
                        <input type="text" name="attr_armornotes" title="Notes" class="notes"/>
                    </div>
                </div>                

            </div>
            
            <div>
                <h3>Weapon 1</h3>
                
                <div class="twocolumns" style="margin-bottom: 1%">
                    <div class="labels">
                        <label>Type</label>
                        <label>Fast / Slow</label>
                        <label>Bulk</label>
                        <label>Notes</label>
                    </div>
                    <div class="valuecolumn">
                        <input type="text" name="attr_weaponone" title="Weapon 1"/>
                        <input type="number" min="-99" max="99" name="attr_weapononefast" value="0" title="FastSlow"/>
                        <input type="number" min="0" max="4" name="attr_weapononebulk" value="0" title="Bulk"/>
                        <input type="text" name="attr_weapononenotes" title="Notes" class="notes"/>
                    </div>
                </div>                  

            </div>
            
            <div>
                <h3>Weapon 2</h3>
                
                <div class="twocolumns" style="margin-bottom: 1%">
                    <div class="labels">
                        <label>Type</label>
                        <label>Fast / Slow</label>
                        <label>Bulk</label>
                        <label>Notes</label>
                    </div>
                    <div class="valuecolumn">
                        <input type="text" name="attr_weapontwo" title="Weapon 2"/>
                        <input type="number" min="-99" max="99" name="attr_weapontwofast" value="0" title="FastSlow"/>
                        <input type="number" min="0" max="4" name="attr_weapontwobulk" value="0" title="Bulk"/>
                        <input type="text" name="attr_weapontwonotes" title="Notes" class="notes"/>
                    </div>
                </div>                  

            </div> 
            
            <div>
                <h3>VI</h3>
    			<div style="margin-bottom: 1%">
    			    
                    <div class="twocolumns" style="margin-bottom: 1%">
                        <div class="labels">
                            <label>Capacity</label>
                            <label>Notes</label>
                        </div>
                        <div class="valuecolumn">
                            <input type="number" name="attr_vicapacity" value="0" title="Capacity"/>
                            <input type="text" name="attr_vinotes" title="Notes" class="notes"/>
                        </div>
                    </div>
                    
    				<fieldset class="repeating_exec">
    				    <div class="repeatdiv">
        					Executable <input type="text" name="attr_exec" title="Executable"/>
                            Equipped <input type="checkbox" name="attr_execequip"/>
        					<textarea name="attr_execnote" class="textarea"></textarea>
    					</div>
    				</fieldset>
    				
    			</div>                
            </div>
            
            <div>
                <h3>Cybernetics</h3>
    			<div style="margin-bottom: 1%">

    				<fieldset class="repeating_cyber">
    				    <div class="repeatdiv">
        					Cybernetic <input type="text" name="attr_cyber" title="Cybernetic"/>
        					<textarea name="attr_cybernote" class="textarea"></textarea>
    					</div>
    				</fieldset>
    				
    			</div>                
            </div>            

            <div>
                <h3>Clothing</h3>
    			<div style="margin-bottom: 1%">
    			    
                    <div class="twocolumns" style="margin-bottom: 1%">
                        <div class="labels">
                            <label>Type</label>
                            <label>Pockets</label>
                            <label>Notes</label>
                        </div>
                        <div class="valuecolumn">
                            <input type="text" name="attr_clothing" title="Clothing"/>
                            <input type="number" name="attr_pocketcap" value="0" title="Pockets"/>
                            <input type="text" name="attr_clothnotes" title="Notes" class="notes"/>
                        </div>
                    </div>
                    
                    <h4>Include Additional Small Items Here from Accessories</h4>
    				<fieldset class="repeating_prepitems">
    				    <div class="repeatdiv">
        					Small Item <input type="text" name="attr_prepitem" title="Name"/>
        					Qty <input type="number" name="attr_prepqty" value="0" title="Quantity"/>
        					<div class="notesdiv">
        					    Notes <input type="text" name="attr_prepnotes" title="Notes" class="notes"/>    
        					</div>
    					</div>
    				</fieldset>
    				
    			</div>
			</div>
			
            <div>
                <h3>Accessories</h3>
    			<div style="margin-bottom: 1%">
    			    
    			    <fieldset class="repeating_accessories">
                        <div class="twocolumns" style="margin-bottom: 1%">
                            <div class="labels">
                                <label>Type</label>
                                <label>Slot</label>
                                <label>Pockets</label>
                                <label>Notes</label>
                            </div>
                            <div class="valuecolumn">
                                <input type="text" name="attr_acc" title="Clothing"/>
                                <input type="text" name="attr_slot" title="Slot"/>
                                <input type="number" name="attr_accpocketcap" value="0" title="Pockets"/>
                                <input type="text" name="attr_accnotes" title="Notes" class="notes"/>
                            </div>
                        </div>
    				</fieldset>
    				
    			</div>
			</div>			

            <div>
                <h3>Container</h3>
    			<div style="margin-bottom: 1%">
    			    
                    <div class="twocolumns" style="margin-bottom: 1%">
                        <div class="labels">
                            <label>Type</label>
                            <label>Capacity</label>
                            <label>Notes</label>
                        </div>
                        <div class="valuecolumn">
                            <input type="text" name="attr_container" title="Container"/>
                            <div>
                                <input type="number" name="attr_stowbulksum" value="0" title="Current"/> / <input type="number" name="attr_containercap" value="0" title="Capacity"/>
                            </div>
                            <input type="text" name="attr_containernotes" title="Notes" class="notes"/>
                        </div>
                    </div>    			    
    			    
    				<fieldset class="repeating_stowitems">
    				    <div class="repeatdiv">
        					Item <input type="text" name="attr_stowitem" title="Item"/>
        					Qty <input type="number" name="attr_stowqty" value="0" title="Quantity"/>
        					Bulk <input type="number" min="0" max="4" name="attr_stowbulk" value="0" title="Bulk"/>	
                            Equipped <input type="checkbox" name="attr_stowequip"/>
        					<div class="notesdiv">
        					    Notes <input type="text" name="attr_stownotes" title="Notes" class="notes"/>    
        					</div>
    					</div>
    				</fieldset>
    				
    			</div>
			</div>
			
			
		</div>
	
	</div>
	
	<div class="page4">
	    
		<div class="twocolumns">						
			<div class="labels">
				<label>Lifestyle</label>
				<label style="margin-top:25px;">Cost of Living</label>
				<label>Fatigue Die Bonus</label>
				<label>Rise & Grind DC</label>
				<label>Socialize DC</label>
				<label>Weekly Prosperity Gain</label>
			</div>
			<div class="valuecolumn">
				<select name="attr_lifestyle">
				    <option value="Destitue">Destitue</option>
				    <option value="Poor">Poor</option>
				    <option value="Getting By">Getting By</option>
				    <option value="Comfortable">Comfortable</option>
				    <option value="Wealthy">Wealthy</option>
				    <option value="Rich">Rich</option>
				</select>
				<input type="text" name="attr_costoflife" readonly/>
				<input type="number" name="attr_bonusfat" readonly/>
				<input type="number" name="attr_grind" readonly/>
				<input type="text" name="attr_social" readonly/>
				<input type="number" name="attr_weekprosp" readonly/>
			</div>					
		</div>	
		
		<div>
			<h3>Species Benefit</h3>
			<textarea name="attr_speciesBen" rows="4"></textarea>
		</div>
		
		<div>
		    <h3>Life Path</h3>
		    <textarea name="attr_life" class="textarea" rows="4"></textarea>
            Home <select name="attr_firstextra">
                <option value="Body">Body Skill+</option>
                <option value="Mental">Mental Skill+</option>
                <option value="Knowledge">Knowledge Skill+</option>
                <option value="Other">Other</option>
            </select>
            Background <select name="attr_secondextra">
                <option value="Body">Body Skill+</option>
                <option value="Mental">Mental Skill+</option>
                <option value="Knowledge">Knowledge Skill+</option>
                <option value="Other">Other</option>
            </select> 
		</div>
	
		<div>
			<h3>Role</h3>
			<input type="text" name="attr_rolename" title="Role">
			<textarea name="attr_role" class="textarea" style="margin-top:1%;"></textarea>
		</div>
	
		<div>
			<h3>Touchstones</h3>
				<fieldset class="repeating_touchstones">
					<div style="margin-top:2%">
						Archetype <input type="text" name="attr_archetype" title="Archetype"/>
						Trust <input type="number" min="0" max="5" name="attr_trust" value="0" title="Trust"/>
                        Highest Trust <input type="number" min="0" max="5" name="attr_hightrust" value="0" title="Highest Trust"/>
						<textarea name="attr_personality" class="textarea" value="Personality, Story, etc." style="margin-top:1%"></textarea>
					</div>
					<div>
				        <h3>Trust Abilities</h3>
					    <textarea name="attr_trustability1" class="textarea"></textarea>
					    <textarea name="attr_trustability2" class="textarea"></textarea>
					    <textarea name="attr_trustability3" class="textarea"></textarea>
					    <textarea name="attr_trustability4" class="textarea"></textarea>
					    <textarea name="attr_trustability5" class="textarea"></textarea>
					</div>
				</fieldset>	
		</div>
	
	</div>
	
</div>

<rolltemplate class="sheet-rolltemplate-wod">
    <table>
        <tr><th>{{name}} rolls{{#roll_name}} {{roll_name}}{{/roll_name}}</th></tr>
        <tr>
            <td class="result">{{result}} Successes</td>        
        </tr>
    </table>
</rolltemplate>

<script type="text/worker">
    on('clicked:page1', function() {
        setAttrs({sheetTab: "page1"});    
    });
    
    on('clicked:page2', function() {
        setAttrs({sheetTab: "page2"});    
    });
    
    on('clicked:page3', function() {
        setAttrs({sheetTab: "page3"});    
    });
    
    on('clicked:page4', function() {
        setAttrs({sheetTab: "page4"});    
    });
    
    const repeatingSum = (destinations, section, fields) => {
        if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
        if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
        getSectionIDs('repeating_${section}', idArray => {
            const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
            getAttrs([...attrArray], v => {
                const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
                const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
                const output = {};
                destinations.forEach((destination, index) => {
                    output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
                });
                setAttrs(output);
            }); 
        }); 
    };    
    
    on('change:repeating_stowitems:stowbulk remove:repeating_stowitems', function() {
    	repeatingSum("stowbulksum","stowitems","stowbulk");
    }); 

    on('change:xp', function() {
        getAttrs(["xp", "chrlv", "xptier"], function(values) {
            let current = Number(values.xp);
            let chrlv = Number(values.chrlv); 
            let goal = chrlv * Number(values.xptier);
            let output = {};
            
            if(current >= goal) {
                output.xp = current - goal;
                output.chrlv = chrlv + 1;
                
                $20("#lvdiv").removeClass('hide');
                
                setAttrs(output);
            }
        });
    });    
    
    on("change:lifestyle", function() {  
        getAttrs(["lifestyle"], function(values) {
            let life = values.lifestyle;
            let output = {};

            if(life === "Destitue") {
                output.costoflife = "Reduce one Touchstone’s Trust by 1";
                output.bonusfat = "-2";
                output.grind = "4";
                output.social = "Unavailable";
                output.weekprosp = "0";
            }
            else if(life === "Poor") {
                output.costoflife = "1";
                output.bonusfat = "-1";
                output.grind = "3";
                output.social = "3";
                output.weekprosp = "0";            
            }            
            else if(life === "Getting By") {
                output.costoflife = "2";
                output.bonusfat = "0";
                output.grind = "2";
                output.social = "2";
                output.weekprosp = "0";
            }     
            else if(life === "Comfortable") {
                output.costoflife = "2";
                output.bonusfat = "1";
                output.grind = "2";
                output.social = "1";
                output.weekprosp = "0";
            }
            else if(life === "Wealthy") {
                output.costoflife = "1";
                output.bonusfat = "2";
                output.grind = "1";
                output.social = "2";
                output.weekprosp = "0";
            }
            else if(life === "Rich") {
                output.costoflife = "Reduce one Touchstone’s Trust by 1";
                output.bonusfat = "2";
                output.grind = "1";
                output.social = "3";
                output.weekprosp = "2";
            }            
            
            setAttrs(output);
        });
    });    
    
    on("clicked:recalc sheet:opened change:npc", function() {
        getAttrs([
            "starting",
            "soldierlv",
            "scoundrellv",
            "leaderlv",
            "diplomatlv",
            "scholarlv",
            "mediclv",
            "specialistlv",
            "prestigelv",
            "melee",
            "ranged",
            "acrobatics",
            "athletics",
            "stealth",
            "pilot",
            "endurance",
            "deception",
            "persuasion",
            "intimidation",
            "empathy",
            "deduction",
            "perception",
            "resolve",
            "art",
            "engineering",
            "logistics",
            "social",
            "science",
            "medicine",
            "survival",
            "firstextra",
            "secondextra",
            "bodyspec",
            "mentspec",
            "knowspec",
            "ins",
            "deft",
            "vigor",
            "cun",
            "cov",
            "weapononefast",
            "weapontwofast",
            "chrlv",
            "xp",
            "strength",
            "weakness",
            "npc"
        ], function(values) {
            let npc = Number(values.npc);
            let sol = Number(values.soldierlv);
            let sco = Number(values.scoundrellv);
            let led = Number(values.leaderlv);
            let dip = Number(values.diplomatlv);
            let sch = Number(values.scholarlv);
            let med = Number(values.mediclv);
            let spc = Number(values.specialistlv);
            let prs = Number(values.prestigelv);
            let str = values.starting;
            let first = values.firstextra;
            let second = values.secondextra;
            let body = Number(values.melee) + Number(values.ranged) + Number(values.acrobatics) + Number(values.athletics) + Number(values.stealth) + Number(values.pilot) + Number(values.endurance) + Number(values.bodyspec);
            let maxbody;
            let ment = Number(values.deception) + Number(values.persuasion) + Number(values.intimidation) + Number(values.empathy) + Number(values.deduction) + Number(values.perception) + Number(values.resolve) + Number(values.mentspec);
            let maxment;
            let know = Number(values.art) + Number(values.engineering) + Number(values.logistics) + Number(values.social) + Number(values.science) + Number(values.medicine) + Number(values.survival) + Number(values.knowspec);
            let maxknow;    
            let output = {};
          
            if(npc > 0) {
                maxbody = 0;             
                maxment = 0;
                maxknow = 0;              
            }
            else if(str == "Soldier") {
                maxbody = 5;             
                maxment = 1;
                maxknow = 3;
            }
            else if(str == "Scoundrel") {
                maxbody = 5;
                maxment = 3;
                maxknow = 1;            
            }
            else if(str == "Leader") {
                maxbody = 3;
                maxment = 5;
                maxknow = 1;            
            }
            else if(str == "Diplomat") {
                maxbody = 1;
                maxment = 5;
                maxknow = 3;
            }
            else if(str == "Scholar") {
                maxbody = 1;
                maxment = 3;
                maxknow = 5;            
            }
            else if(str == "Medic") {
                maxbody = 3;
                maxment = 1;
                maxknow = 5;            
            }                
       
            if(first == "Body") {
                maxbody++;
            }
            else if(first == "Mental") {
                maxment++;
            }
            else if(first == "Knowledge") {
                maxknow++;
            }

            if(second == "Body") {
                maxbody++;
            }
            else if(second == "Mental") {
                maxment++;
            }
            else if(second == "Knowledge") {
                maxknow++;
            }        
  
            maxbody += sol;    
            maxment += Math.floor(sol/3);
            maxknow += Math.floor(sol/2);
            
            maxbody += sco;
            maxment += Math.floor(sco/2);
            maxknow += Math.floor(sco/3);

            maxbody += Math.floor(led/2);
            maxment += led;
            maxknow += Math.floor(led/3);

            maxbody += Math.floor(dip/3);
            maxment += dip;
            maxknow += Math.floor(dip/2);

            maxbody += Math.floor(sch/3);
            maxment += Math.floor(sch/2);
            maxknow += sch;

            maxbody += Math.floor(med/2);
            maxment += Math.floor(med/3);
            maxknow += med;                        
           
            output.assignbody = body;
            output.maxbody = maxbody;
            
            output.assignmental = ment;
            output.maxmental = maxment;
            
            output.assignknowledge = know;
            output.maxknowledge = maxknow;            
      
            if(sol > 0) $20("#solbut").removeClass('hide');
            else $20("#solbut").addClass('hide');
            
            if(sco > 0) $20("#scobut").removeClass('hide');
            else $20("#scobut").addClass('hide');

            if(sch > 0) $20("#schbut").removeClass('hide');
            else $20("#schbut").addClass('hide');

            if(led > 0) $20("#ledbut").removeClass('hide');
            else $20("#ledbut").addClass('hide');

            if(dip > 0) $20("#dipbut").removeClass('hide');
            else $20("#dipbut").addClass('hide');

            if(med > 0) $20("#medbut").removeClass('hide');
            else $20("#medbut").addClass('hide');            

            let kspecs = Number(values.knowspec);
            let ins = Number(values.ins);
            let bril = 0;

            if(kspecs >= ins) bril = ins;
            else if(ins > kspecs) bril = kspecs;            
            output.brildie = bril;
            
            let gen = 0;
            gen = kspecs;
            if(gen > 4) gen = 4;            
            output.gendie = gen;
            
            let deft = Number(values.deft);
            let wone = Number(values.weapononefast);
            let wtwo = Number(values.weapontwofast);
            let litone = 0;
            let littwo = 0;
            
            if(wone >= deft) litone = deft;
            else if(deft > wone) litone = wone;
            output.litonedie = litone;
            
            if(wtwo >= deft) littwo = deft;
            else if(deft > wtwo) littwo = wtwo;            
            output.littwodie = littwo;       

            let chrlv = Number(values.chrlv);
            let xptier = 0;
            if(chrlv < 6) xptier = 25;
            else if(chrlv < 12) xptier = 50;
            else if(chrlv < 24) xptier = 100;
            else if(chrlv < 36) xptier = 200;
            else xptier = 400;
            output.xptier = xptier;
            
            let current = Number(values.xp);
            let goal = chrlv * xptier;
            let totallvs = sol + sco + led + dip + sch + med + spc + prs;
            if(current >= goal || totallvs < chrlv) $20("#lvdiv").removeClass('hide');
            else $20("#lvdiv").addClass('hide');
            
            let vigor = Number(values.vigor);
            let condvig = 0;
            if(vigor > 4) condvig = 4;
            else condvig = vigor;
            output.condvig = condvig;

            let cov = Number(values.cov);
            let condcov = 0;
            if(cov > 4) condcov = 4;
            else condcov = cov;            
            output.condcov = condcov;     

            let cun = Number(values.cun);
            let fat = 0;
            let strength = values.strength;
            let weak = values.weakness;
            
            if(strength == "Fatigue") fat++;
            if(weak == "Fatigue") fat--;
            
            output.abcur = vigor + deft + ins + cun + cov + fat;
            output.abtotal = 5 + 5 + Math.floor(chrlv/3) + fat;
            output.personalfat = fat;
 
            setAttrs(output);
        });
    });
</script>
